# +
# -*- coding: utf-8 -*-
# Copyright (c) Meta Platforms, Inc. and affiliates.
#
# pytx documentation build configuration file, created by
# Author:MengXuan Chen
# date:2024.3.28
# Institute:JSPI



import sys
import os
sys.path.append(r"C:\Users\DELL\机器学习")
#import d2l
import time
import re
import urllib
import requests
import numpy as np
import pandas as pd
import subprocess


# -

#使用apktool工具批量解压缩安卓软件包
class ExtractModule:
    def __init__(self,source,target=None,is_one_file=True,**kwargs):
        self.s=source #安卓压缩包源路径
        self.d=target #解压后的包所在路径
        self.oneflag=is_one_file
    
    #检查文件后缀名是否为.apk
    def __check_extension(self):
        flag=True
        if self.oneflag:
            source=[self.s]
        else:
            source=self.s
        for path in source:
            if os.path.splitext(path)[1]!=".apk":
                flag=False
        return flag
    
    #检查源文件与目的文件数量是否相等
    def __CheckNum(self):
        if len(self.s)!=len(self.d):
            return False
        return True
    
    #待解压缩安卓软件仅为一个的情况
    def __ExtractOneFile(self):
        if self.__check_extension():
            command="apktool d {} -o {}".format(self.s,self.d)
            try:
                system_response=os.system(command)
                assert system_response==0
                os.system("taskkill /f /im cmd.exe")
                print("extract successfully")
            except AssertionError:
                print("extract unsuccessfully!")
        else:
            print("This is not avalid apk file")
       
    #批量解压缩安卓软件
    def __ExtractFileList(self):
        if self.__check_extension() and self.__CheckNum():
            for inputfile,outputfile in zip(self.s,self.d):
                command="apktool d {} -o {}".format(inputfile,outputfile)
                try:
                    system_response=os.system(command)
                    assert system_response==0
                    #print(system_response)
                    print("extract successfully!")
                except AssertionError:
                    print ("extract unsuccessfully!")
        else:
            print ("The file is not an apk file!")
    os.system("taskkill /f /im cmd.exe")
    
    #类的主函数入口
    def run(self):
        if self.oneflag:
            self.__ExtractOneFile()
        else:
            self.__ExtractFileList()

